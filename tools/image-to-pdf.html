<h1>Images to PDF Converter</h1>

<div class="controls">
    <div class="file-input-wrapper">
        <label for="image-input" class="custom-file-upload">Select Images</label>
        <input type="file" id="image-input" accept="image/*" multiple>

        <label for="add-more-images" class="custom-file-upload">Add More Images</label>
        <input type="file" id="add-more-images" accept="image/*" multiple>
    </div>
    
    <input type="text" id="pdf-name" placeholder="Enter custom PDF name (e.g., my-report)">
</div>

<button id="convert-button" disabled>Convert to PDF</button>

<div id="image-preview"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
    // Note: All JS logic remains the same
    const imageInput = document.getElementById('image-input');
    const addMoreImagesInput = document.getElementById('add-more-images');
    const imagePreview = document.getElementById('image-preview');
    const convertButton = document.getElementById('convert-button');
    const pdfNameInput = document.getElementById('pdf-name');
    
    let selectedImages = [];

    const handleFiles = (files) => {
        for (const file of files) {
            if (!file.type.startsWith('image/')){ continue }
            const reader = new FileReader();
            reader.onload = (e) => {
                const imageDataUrl = e.target.result;
                selectedImages.push(imageDataUrl);
                const card = document.createElement('div');
                card.classList.add('preview-card');
                const img = document.createElement('img');
                img.src = imageDataUrl;
                img.classList.add('preview-image');
                card.appendChild(img);
                imagePreview.appendChild(card);
            };
            reader.readAsDataURL(file);
        }
        setTimeout(() => {
            if(selectedImages.length > 0) convertButton.disabled = false;
        }, 500);
    };

    imageInput.addEventListener('change', (event) => {
        imagePreview.innerHTML = '';
        selectedImages = [];
        convertButton.disabled = true;
        handleFiles(event.target.files);
    });

    addMoreImagesInput.addEventListener('change', (event) => {
        handleFiles(event.target.files);
    });

    convertButton.addEventListener('click', () => {
        if (selectedImages.length === 0) {
            alert('Please select at least one image.');
            return;
        }
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        selectedImages.forEach((image, index) => {
            try {
                if (index > 0) doc.addPage();
                const imgProps = doc.getImageProperties(image);
                const pdfWidth = doc.internal.pageSize.getWidth();
                const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                let finalHeight = pdfHeight, finalWidth = pdfWidth;
                const pageHeight = doc.internal.pageSize.getHeight();
                if (pdfHeight > pageHeight) {
                    finalHeight = pageHeight;
                    finalWidth = (imgProps.width * pageHeight) / imgProps.height;
                }
                const x = (pdfWidth - finalWidth) / 2;
                const y = (pageHeight - finalHeight) / 2;
                doc.addImage(image, 'JPEG', x, y, finalWidth, finalHeight);
            } catch(e) {
                console.error("Error adding image:", e);
                alert(`Error processing image ${index + 1}.`);
            }
        });
        const fileName = pdfNameInput.value.trim() || 'converted-images';
        doc.save(`${fileName}.pdf`);
    });
</script>
